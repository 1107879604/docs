.. _ips:

==========================
IPS (Intrusion Prevention)
==========================

The IPS (Intrusion Prevention System) module configures Snort using the netfilter queue (NFQUEUE). 
NFQUEUE is an iptables and ip6tables target which delegate the decision on packets to a userspace software.

All inter-zone traffic will be analyzed by Snort itself.

Snort rules are managed by Pulledpork.
Alert logs are generated by SnortALog and are available inside the Dashboard. 

Snort will analyze:

* all inter-zone traffic, except traffic from firewall to local network
* all traffic from port forwards

Manually enable/disable snort
=============================

Snort will analyze network traffic only if ``nfqueue`` property inside the ``firewall`` key is set to enabled.
The web interface will take care of this by assuring both ``firewall{nfqueue}`` and ``snort{status}`` are set to ``enabled`` (or ``disabled``).

Enabling: ::

  config setprop firewall nfqueue enabled
  config setprop squid status enabled
  signal-event firewall-adjust
  signal-event nethserver-snort-save

Disabling: ::

  config setprop firewall nfqueue disabled
  config setprop squid status disabled
  signal-event firewall-adjust
  signal-event nethserver-snort-save


.. warning:: If ``nfqueue`` is enabled, and Snort is not started, all network traffic will be blocked and no network service will work (including gateway capabilities).


Policies
========

The package implements 4 policies. A policy is a set of rules which will change Snort behavior. Available policies are:

* *Connectivity*: You run a lot of real time applications (VOIP, financial
  transactions, etc), and don't want to run any rules that could affect
  the current performance of your gateway. Rules in this category
  make snort happy, additionally this category focuses on the high
  profile most likely to affect the largest number of people type of
  vulnerabilities.

* *Balanced*:  You are normal, you run normal stuff and you want normal
  security protections.  This is the best policy to start from if you are 
  new, old, or just plain average.  If you don't have any special
  requirements for super high speeds or super secure networks start here.

* *Security*:  You don't care about dropping your bosses email, everything
  in your environment is tightly regulated and you don't tolerate people 
  stepping outside of your security policy.  This policy hates on IM, P2P,
  vulnerabilities, malware, web apps that cause productivity loss, remote
  access, and just about anything not related to getting work done.  
  If you run your network with an iron fist start here.

* *Expert*: no policy is applied. All rules must be manually select by the administrator (see pulledpork documentation).


Changing the current policy to ``security``: ::

  config setprop pulledpork Policy security
  signal-event nethserver-pulledpork-save


Troubleshooting
===============

When troubleshooting network traffic, just remember that Snort will intercept all the traffic.

To temporary disable Snort use: ::

  config setprop firewall nfqueue disabled
  signal-event firewall-adjust

To re-enable Snort: ::
  
  config setprop firewall nfqueue enabled
  signal-event firewall-adjust
